<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 3rd party libraries -->
    <script src="/static/3rdparty/jquery-3.3.1.min.js"></script>
    <script src="/static/3rdparty/tf.min37.js"></script>
    <script src="/static/3rdparty/moment.min.js"></script>
    <script src="/static/3rdparty/popper.min.js"></script>
    <script src="/static/3rdparty/stats.js"></script>
    <script src="/static/3rdparty/dat.gui.min.js"></script>
    <script src="/static/3rdparty/gsap.min.js"></script>
    <script src="/static/3rdparty/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="/static/3rdparty/bootstrap-4.3.1/js/bootstrap.min.js"></script>
    <script src="/static/3rdparty/three.js-r131/three.min.js"></script>
    <!-- <script src="/static/3rdparty/three.js-r103/LoaderSupport.js"></script> -->
    <script src="/static/3rdparty/three.js-r131/MTLLoader.js"></script>
    <script src="/static/3rdparty/three.js-r131/OBJLoader.js"></script>
    <script src="/static/3rdparty/three.js-r131/TGALoader.js"></script>
    <script src="/static/3rdparty/three.js-r131/TransformControls.js"></script>
    <script src="/static/3rdparty/three.js-r131/EffectComposer.js"></script>
    <script src="/static/3rdparty/three.js-r131/OutlinePass.js"></script>
    <script src="/static/3rdparty/three.js-r131/RenderPass.js"></script>
    <script src="/static/3rdparty/three.js-r131/ShaderPass.js"></script>
    <script src="/static/3rdparty/three.js-r131/CopyShader.js"></script>
    <script src="/static/3rdparty/three.js-r103/OrbitControls.js"></script>
    <script src="/static/3rdparty/three.js-r103/PointerLockControls.js"></script>
    <script src="/static/3rdparty/threex.windowresize.js"></script>
    <script src="/static/3rdparty/radial.js"></script>
    <script src="/static/3rdparty/recorder.js"></script>
    <script src="/static/3rdparty/socket.io.min.js"></script>
    <link rel="stylesheet" href="/static/3rdparty/jquery-ui-1.12.1/jquery-ui.min.css"/>
    <link rel="stylesheet" href="/static/3rdparty/bootstrap-4.3.1/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/3rdparty/bootstrap/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://unpkg.com/splitting/dist/splitting.css"/>
    <link rel="stylesheet" href="https://unpkg.com/splitting/dist/splitting-cells.css"/>
    <script src="https://unpkg.com/splitting/dist/splitting.min.js"></script>
    <!-- our code -->
    <link rel="stylesheet" href="/static/css/color-bootstrap.min.css" />
    <link rel="stylesheet" href="/static/css/index.css" />
    <link rel="stylesheet" href="/static/css/tiler.css" />
    <script src="/static/js/SceneManager.js"></script>
    <script src="/static/js/drawcanvas.js"></script>
    <script src="/static/js/render.js"></script>
    <script src="/static/js/radial.js"></script>
    <script src="/static/js/orth.js"></script>
    <script src="/static/js/QE.js"></script>
    <script src="/static/js/ai.js"></script>
    <script src="/static/js/search.js"></script>
    <script src="/static/js/sk.js"></script>
    <script src="/static/js/online.js"></script>
    <script src="/static/js/audio_recording.js"></script>
    <script src="/static/js/MageAdd.js"></script>
    <script>
      //Global state & variables! Careful!
      var ALL_SCENE_READY = false;
      var On_MOVE = false;
      var On_ROTATE = false;
      var On_LIFT = false;
      var On_ADD = false;
      var On_SCALE = false;
      var On_xSCALE = false;
      var On_ySCALE = false;
      var On_zSCALE = false;
      var On_Orth_MOVE = false;
      var isToggle = false;
      var Auto_Insert_Mode = false;
      var Auto_Rec_Mode = false;
      var AUXILIARY_MODE = false;
      var LayoutViewAdjust_MODE = false;
      var lighting_Mode = false;
      const AUXILIARY_NAME = "auxiliaryObject";
      const INSERT_NAME = "INSERT_ON_ADD";
      const SEMANTIC_POINTLIGHT = "semanticBasedPointLight";
      var INTERSECT_OBJ;
      var INSERT_OBJ;

      //Global variables, will be initialize only once.
      var manager;
      var menu;
      var radial;
      var radial_scale;
      var renderer;
      var composer, renderPass, outlinePass, outlinePass2; // Post-Processing. 
      var camera;
      var scene;
      var orbitControls;
      var transformControls;

      var mouse = new THREE.Vector2();
      var orthmouse = new THREE.Vector2();
      var raycaster = new THREE.Raycaster();
      var scenecanvas;
      var orthcanvas;
      var drawingCanvas;
      var catalogItems;
      var paint = false;
      var drawStartPos = new THREE.Vector2();
      var searchResults;
      var currentRoomId;
      var orthline;

      var skyBox;
      var lx_level;
      var lz_level;
      var renderTime = 0.6;
      var axis;

      var latent_space_mode;

      var stats;
      var datgui;
      var datgui_intersectfolder;

      // this variable is used for determining the collaborative group a user belonging to;
      const onlineGroup = "{{ onlineGroup }}";
      const onlineUserID = "{{ serverGivenUserID }}";
      const onlineUser = { id: "{{ serverGivenUserID }}", name: "" };

      $(document).ready(function () {
        latent_space_mode = false;
        manager = new SceneController($("#ui")[0]);
        renderer = manager.renderManager.renderer;
        camera = manager.renderManager.camera;
        scene = manager.renderManager.scene;

        scenecanvas = document.getElementById("scenecanvas");
        orthcanvas = document.getElementById("orthcanvas");
        catalogItems = document.getElementById("catalogItems");
        drawingCanvas = document.getElementById("drawing-canvas");
        setting_up();
      });
    </script>
  </head>
  <body>
    <div id="ui">
      <div class="collapse show" id="sidebar">
        <div id="retrieve" class="d-flex flex-column" align="center">
          <div class="bg-primary p-4" style="height: 50.75px">
            <a
              class="dropdown-toggle h3"
              id="title"
              role="button"
              href="#sceneInfo"
              data-toggle="collapse"
              aria-expanded="false"
              aria-controls="sceneInfo"
              >3D Scene Platform</a
            >
          </div>
          <table
            class="collapse table text-dark table-responsive"
            id="sceneInfo"
          >
            <tbody>
              <tr>
                <th scope="row">Level</th>
                <td colspan="3" id="tab_origin"></td>
              </tr>
              <tr>
                <th scope="row">Room ID</th>
                <td id="tab_roomid"></td>
                <th>Room Type</th>
                <td id="tab_roomtype"></td>
              </tr>
              <tr>
                <th scope="row">Model ID</th>
                <td id="tab_modelid"></td>
                <th>Category</th>
                <td id="tab_category"></td>
              </tr>
              <tr>
                <th scope="row">AuxObj</th>
                <td colspan="3" id="tab_auxobj"></td>
              </tr>
              <tr>
                <th scope="row">AuxDom</th>
                <td colspan="3" id="tab_auxdom">ALL</td>
              </tr>
              <tr>
                <th scope="row">FPSavg</th>
                <td id="tab_FPSavg"></td>
                <th>Min-Max</th>
                <td id="tab_minmax"></td>
              </tr>
            </tbody>
          </table>

          <!--div class="card-body">
                <button id="text_button" type="button" class="btn btn-lg btn-primary" style="width:32.5%;">Text</button>
                <button id="sketch_button" type="button" class="btn btn-lg btn-primary" style="width:32.5%;">Sketch
                </button>
                <button id="rec_button" type="button" class="btn btn-lg btn-primary" style="width:32.5%;">Rec</button>
                <div style="margin-top: 10px" id="record_panel">
                    <button id="start_record_button" type="button" onclick="start_reco()" class="btn btn-lg btn-primary"
                            style="width:49%;">Start
                        Recording
                    </button>
                    <button id="stop_record_button" type="button" onclick="stop_reco()" class="btn btn-lg btn-primary"
                            style="width:49%; background-color: red; display: none">Stop
                        Recording
                    </button>
                    <button id="submit_record_button" type="button" onclick="get_audio()" class="btn btn-lg btn-primary"
                            style="width:49%;">Submit
                        Recording
                    </button>
                    <div id="audio_error" class="alert alert-danger" style="display: none; margin-top: 10px">Error!
                    </div>
                    <div id="audio_processing" class="alert alert-info" style="display: none; margin-top: 10px">Audio
                        Processing ...
                    </div>
                    <div id="audio_ok" class="alert alert-success" style="display: none; margin-top: 10px">Success!
                    </div>
                </div>
                <button id="colla_button" type="button" class="btn btn-lg btn-primary"
                        style="margin-top: 10px; width:100%;">
                    Collaborative Search
                </button>
            </div-->
          <div class="py-1 px-0">
            <button
              id="autoView"
              type="button"
              class="btn btn-outline-dark m-1 btn-responsive"
            >
              SceneViewer
            </button>
            <button
              id="autoViewPath"
              type="button"
              class="btn btn-outline-dark m-1 btn-responsive"
            >
              AutoPath
            </button>
            <button
              id="autoViewMapping"
              type="button"
              class="btn btn-outline-dark m-1 btn-responsive"
            >
              Mapping
            </button>
            <button
              id="manyTextures"
              type="button"
              class="btn btn-outline-dark m-1 btn-responsive"
            >
              Texture
            </button>
          </div>
          <div class="py-1 px-0">
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >双人床</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >茶几</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >餐桌</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >小圆桌</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >梳妆台</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >衣柜</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >电视柜</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >沙发</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >椅子</button>
            <button
              id=""
              type="button"
              class="btn btn-lg btn-outline-dark rapidSearch m-1"
            >储物柜</button>
          </div>
          <div id="collaborative_container">
            <a class="dropdown-toggle h4 my-2 d-block" data-toggle="collapse" href="#drawingCanvasDiv" role="button" aria-expanded="false" aria-controls="drawingCanvasDiv">
              Drawing Canvas
            </a>
            <div class="collapse" id="drawingCanvasDiv">
              <canvas id="drawing-canvas" height="224" width="224" style="color: aliceblue;"></canvas>
              <div id="sketchsearchdiv" class="btn-group mx-1 my-3">
                  <button class="btn btn-outline-primary btn-canvas-responsive" type="submit" id="sketchsearchbtn">
                      Sketch Search
                  </button>
                  <button class="btn btn-outline-primary btn-canvas-responsive" type="submit" id="sketchclearbtn">
                      Sketch Clear
                  </button>
              </div>
            </div>
            <div class="input-group input-group-lg py-2 px-3">
              <input
                class="form-control"
                type="text"
                placeholder="Search"
                aria-label="Search"
                id="searchinput"
              />
              <div class="input-group-append">
                <button
                  class="btn btn-outline-primary"
                  type="submit"
                  id="searchbtn"
                >
                  Object
                </button>
                <button
                  class="btn btn-outline-primary"
                  type="submit"
                  id="floorPlanbtn"
                >
                  FloorPlan
                </button>
              </div>
            </div>
            <!-- <form class="navbar-form navbar-left" action="/action_page.php">
                    <div class="input-group">
                        <input id="searchinput" type="text" class="form-control" placeholder="Search" name="search">
                        <div class="input-group-btn">
                            <button id="searchbtn" class="btn btn-default btn-outline-dark" type="submit">
                            <i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form> -->
          </div>
          <div id="rec_container" style="display: none"></div>
          <div
            id="catalogItems"
            class="catalogSectionContent mb-auto"
            align="center"
          ></div>
          <div>
            <a class="text-muted" style="overflow-wrap: break-word"
              >Dev. Shao-Kui. zhangsk18@mails.tsinghua.edu.cn</a
            >
          </div>
        </div>
      </div>
      <div id="content">
        <nav
          id="menubar"
          class="navbar navbar-expand-lg navbar-dark bg-primary py-3"
        >
          <button
            class="btn btn-lg mr-auto"
            id="sidebar_button"
            type="button"
            data-toggle="collapse"
            data-target="#sidebar"
            aria-controls="sidebar"
            aria-expanded="true"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div id="menuBtns">
            <button
              id="load_button"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              Load
            </button>
            <button
              id="auxiliary_button"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              AuxiliaryMode
            </button>

            <button
              id="sklayout"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              Layout1
            </button>

            <button
              id="firstperson_button"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >First-Person</button>

            <button
              id="download_button"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              Save
            </button>
            <button
              id="screenshot"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              Render
            </button>
            <button
              id="axis_button"
              type="button"
              class="btn btn-lg btn-outline-light mx-2"
            >
              Axis
            </button>
          </div>

          <div class="dropdown">
            <button
              type="button"
              id="utils_button"
              class="btn btn-lg btn-outline-light dropdown-toggle mx-2"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              Utils<span class="caret"></span>
            </button>
            <div
              class="dropdown-menu bg-primary dropdown-menu-right"
              aria-labelledby="utils_button"
              style="text-align: center"
            >
              <button
                type="button"
                id="windoor_button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                WinDoor
              </button>
              <button
                type="button"
                id="clear_button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                Clear
              </button>
              <button
                type="button"
                id="clearALL_button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                ClearALL
              </button>
              <button
                type="button"
                id="layoutviewadjust_button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                ViewAdjust
              </button>
              <button
                type="button"
                id="bestview_button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                BestView
              </button>
              <button
                id="lighting_btn"
                type="button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                Lighting
              </button>
              <button
                id="layout2_button"
                type="button"
                class="btn btn-outline-light my-1 nav_sk_button"
              >
                layout2
              </button>
            </div>
          </div>
          <a id="downloadAnchorElem" style="display: none"></a>
        </nav>

        <div id="uibody">
          <div id="scene">
            <canvas id="scenecanvas"></canvas>
            <canvas id="orthcanvas"></canvas>
          </div>
        </div>
      </div>
      <div id="load_dialog" class="dialog" title="Load Scene File">
        <div class="form-group">
          <label for="load_dialog_input">LoadFile</label>
          <input type="file" class="form-control-file" id="load_dialog_input" />
        </div>
        <button type="button" class="btn btn-primary" id="load_dialog_button">
          载入
        </button>
      </div>

      <div id="menu2" class="radialMenu"></div>
      <div id="menu_scale" class="radialMenu"></div>
      <!-- <div class="tiler" id="mappingDisplay" style="width: 0%;height: 0%;position: absolute;top: 0;left: 0;z-index: 10;display: none;pointer-events:none;">
        <img id="mappingDisplayImg" src="/autoviewimgs/mapping/0338bdd5-e321-467e-a998-38f2218e2fdd" height="10px" width="10px"/>
    </div> -->
    </div>
  </body>
</html>
